<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¹Ø¯Ù‘ ÙˆØ±Ù‚ Ø§Ù„ØªØ±ÙŠÙƒØ³</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial;
  background:#eaeaea;
  text-align:center;
  padding:10px;
  margin:0;
}

h2{margin:20px 0 5px}
#count{font-size:20px;margin-bottom:10px}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙˆØ±Ù‚ */
.cardsBox{
  background:#fff;
  padding:10px;
  border-radius:10px;
}

/* Ø²Ø± Ø§Ù„ÙˆØ±Ù‚Ø© */
.cardBtn{
  width:110px;
  height:80px;
  margin:6px;
  border:1px solid #ccc;
  border-radius:6px;
  background:#fff;
  font-size:32px;
  font-weight:bold;
}

.S{color:#000;}
.H{color:#c62828;}
.D{color:#c62828;}
.C{color:#000;}

.stats{
  background:#fff;
  padding:10px;
  border-radius:10px;
  margin-top:10px;
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
.controlBtn{
  margin:5px;
  padding:10px 18px;
  font-size:15px;
  border:none;
  border-radius:6px;
  color:#fff;
}
.undo{background:#1976d2;}
.reset{background:#555;}
.add{background:#2e7d32;}
</style>
</head>

<body>

<h2>ğŸ‚¡ Ø¹Ø¯Ù‘ ÙˆØ±Ù‚ Ø§Ù„ØªØ±ÙŠÙƒØ³</h2>
<div id="count">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 52</div>

<!-- Ø±ÙØ¹ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø© -->
<input type="file" id="screenshot" accept="image/*"><br><br>
<button class="controlBtn add" onclick="processScreenshot()">ğŸ“· ØªØ­Ù„ÙŠÙ„ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©</button>

<div class="cardsBox" id="buttons"></div>
<div class="stats" id="stats"></div>

<button class="controlBtn undo" onclick="undo()">â†©ï¸ ØªØ±Ø§Ø¬Ø¹</button>
<button class="controlBtn reset" onclick="reset()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©</button>

<script>
const suits = ['S','H','C','D']; // â™¦ Ø¢Ø®Ø±
const suitIcons = {S:'â™ ',H:'â™¥',D:'â™¦',C:'â™£'};
const ranks = ['A','K','Q','J','10','9','8','7','6','5','4','3','2'];

let cards = JSON.parse(localStorage.getItem("cards"));
let history = JSON.parse(localStorage.getItem("history")) || [];

if(!cards) reset();
else buildButtons();

function save(){
  localStorage.setItem("cards",JSON.stringify(cards));
  localStorage.setItem("history",JSON.stringify(history));
}

function reset(){
  history=[];
  cards=[];
  for(let s of suits)
    for(let r of ranks)
      cards.push(r+s);

  save();
  buildButtons();
  update();
}

function play(card){
  if(!cards.includes(card)) return alert("Ø§Ù„ÙˆØ±Ù‚Ø© Ù…Ø­Ø³ÙˆØ¨Ø©!");
  history.push(card);
  cards = cards.filter(c => c!==card);
  save();
  document.getElementById(card).style.display="none";
  update();
}

function undo(){
  if(history.length===0) return;
  let last = history.pop();
  cards.push(last);
  save();
  document.getElementById(last).style.display="inline-block";
  update();
}

function update(){
  document.getElementById("count").innerText="Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: "+cards.length;
  let text="";
  for(let s of suits){
    let c = cards.filter(x=>x.endsWith(s)).length;
    text += `${suitIcons[s]} Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${c}<br>`;
  }
  document.getElementById("stats").innerHTML=text;
}

function buildButtons(){
  let html="";
  for(let s of suits){
    for(let r of ranks){
      let c=r+s;
      let hidden = cards.includes(c) ? "" : "style='display:none'";
      html+=`
      <button id="${c}" class="cardBtn ${s}"
      onclick="play('${c}')" ${hidden}>
      ${r}${suitIcons[s]}
      </button>`;
    }
    html+="<br>";
  }
  document.getElementById("buttons").innerHTML=html;
}

// ================= Ù…ÙŠØ²Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ =================
async function recognizeCardsAI(base64Image) {
  const apiKey = "PUT_YOUR_API_KEY_HERE"; // ğŸ”´ Ø­Ø· Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§

  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + apiKey
    },
    body: JSON.stringify({
      model: "gpt-4.1-mini",
      messages: [
        {
          role: "user",
          content: [
            { type: "text", text: "Ø§Ø³ØªØ®Ø±Ø¬ ÙƒÙ„ Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© ÙÙŠ Ø§Ù„ØµÙˆØ±Ø© ÙÙ‚Ø· Ø¨ØµÙŠØºØ© JSON Ù…Ø«Ù„: [\"Aâ™ \",\"10â™¦\"]" },
            { type: "image_url", image_url: { url: base64Image } }
          ]
        }
      ],
      max_tokens: 200
    })
  });

  const data = await response.json();

  try {
    return JSON.parse(data.choices[0].message.content);
  } catch {
    alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø£ÙŠ ÙˆØ±Ù‚ ÙˆØ§Ø¶Ø­");
    return [];
  }
}

async function processScreenshot(){
  const fileInput = document.getElementById("screenshot");
  if(fileInput.files.length === 0) return alert("Ø§Ø®ØªØ± Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©!");

  const file = fileInput.files[0];
  const reader = new FileReader();

  reader.onload = async function(e){
    const base64Image = e.target.result;

    const detectedCards = await recognizeCardsAI(base64Image);

    detectedCards.forEach(card=>{
      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ù…ÙˆØ² Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ ÙƒÙˆØ¯Ùƒ
      let code = card.replace("â™ ","S")
                     .replace("â™¥","H")
                     .replace("â™¦","D")
                     .replace("â™£","C");

      if(cards.includes(code)) play(code);
    });
  };

  reader.readAsDataURL(file);
}
</script>

</body>
</html>
